<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no, minimal-ui">
		<script src="../lib/pixi.5.3.2.min.js"></script>
		<script src="../dist/CanvasRecorder.js"></script>
	</head>
	<body>
		<canvas width="200" height="200"></canvas>
		<script>
			const app = new PIXI.Application();
			document.body.appendChild(app.view);
			const w = app.stage.addChild(new PIXI.Sprite(PIXI.Texture.WHITE));
			app.start();
			app.ticker.add(e => {
				w.y += 1;
			});
			app.render();
			const b = new CanvasRecorder(app.view, {})
			
			//const b = new CanvasRecorder(app.view)
			/*
			b._recorder.addEventListener('dataavailable', e => {
						const blob = new Blob([ e.data ], { type: e.data.type });
						const blobURL = window.URL.createObjectURL(blob);
						const anchor = document.createElement('a');
						anchor.download = `${location.hostname}_${new Date().toLocaleString().replace(/[\/\s\:]/g, '.')}.webm`;
						anchor.href = blobURL;
						anchor.click();
						window.URL.revokeObjectURL(blobURL);
						//end();
					});
					
					//b.start();
					
					setTimeout(() => {
					app.stop()
					
					//	b.stop();
					}, 2000)
					*/
				console.log(b._recorder)
				console.log(b._recorder.state)
			b.pause();b.pause();b.start();	
				/*
				setTimeout(()=>{
					b.pause()
				},2000)
					setTimeout(()=>{
					b.resume()
				},4000)
				*/
				
				setTimeout(()=>{
					b.finishAsync()
						.then(movie => {
							//movie.view();
							movie.download()
							const video = document.body.appendChild(movie.createVideoElement())
							
							b.start()
							
							setTimeout(()=>{
								b.finishAsync().then(movie => {
									movie.download()
									console.log(7)
								})
								console.log(5)
							},2000)
							
							
							//video.controls = true;
						//	location.href = movie._blobURL;
							//movie.download()
						})
					
					b.finishAsync()
						.then(movie => {
							//movie.view();
							//const video = document.body.appendChild(movie.createVideoElement())
							//video.controls = true;
						//	location.href = movie._blobURL;
							//movie.download()
						})
					
				},2000)
		</script>
	</body>
</html>