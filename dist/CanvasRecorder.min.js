/*!
 * @tawaship/canvas-recorder - v1.0.0
 * 
 * @author tawaship (makazu.mori@gmail.com)
 * @license MIT
 */
var CanvasRecorder=function(){"use strict";
/*!
 * @tawaship/emitter - v3.0.0
 * 
 * @author tawaship (makazu.mori@gmail.com)
 * @license MIT
 */var e=function(){this._events={}},t={eventNames:{configurable:!0}};t.eventNames.get=function(){return Object.keys(this._events)},e.prototype._on=function(e,t,r){if(!e||!t)return this;for(var i=this._events[e]=this._events[e]||[],n=0;n<i.length;n++)if(i[n].func===t)return this;return i.push({func:t,once:r}),this},e.prototype.on=function(e,t){return this._on(e,t,!1)},e.prototype.once=function(e,t){return this._on(e,t,!0)},e.prototype.off=function(e,t){if(!e||!t)return this;for(var r=this._events[e]||[],i=0;i<r.length;i++)if(r[i].func===t)return r.splice(i,1),this;return this},e.prototype.emit=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];if(!e)return this;for(var i=this._events[e]||[],n=[],o=i.length-1;o>=0;o--){var s=i[o];s.once&&i.splice(o,1),n.push(s)}for(var a=n.length-1;a>=0;a--)n[a].func.apply(this,t);return this},e.prototype.cemit=function(e,t){for(var r=[],i=arguments.length-2;i-- >0;)r[i]=arguments[i+2];if(!e||null==t)return this;for(var n=this._events[e]||[],o=[],s=n.length-1;s>=0;s--){var a=n[s];a.once&&n.splice(s,1),o.push(a)}for(var c=o.length-1;c>=0;c--)o[c].func.apply(t,r);return this},e.prototype.clear=function(e){return void 0===e&&(e=""),e?delete this._events[e]:this._events={},this},Object.defineProperties(e.prototype,t);var r={channelCount:2},i=function(e){this._blobURL=window.URL.createObjectURL(e)};i.prototype.createVideoElement=function(){if(!this._blobURL)throw new Error("[CanvasRecorder] This movie instance was destroyed.");var e=document.createElement("video");return e.src=this._blobURL,e.setAttribute("controls",""),e},i.prototype.download=function(){if(!this._blobURL)throw new Error("[CanvasRecorder] This movie instance was destroyed.");var e=document.createElement("a");e.download=location.hostname+"_"+(new Date).toLocaleString().replace(/[\/\s\:]/g,"-")+".webm",e.href=this._blobURL,e.click()},i.prototype.destroy=function(){window.URL.revokeObjectURL(this._blobURL),this._blobURL=null};var n=function(t,r){var i=this;void 0===r&&(r={}),this._buildPromise=null,this._buildEmitter=new e,this._movie=null;var n=new MediaStream;t.captureStream().getVideoTracks().forEach((function(e){n.addTrack(e)}));var o=[];this._recorder=new MediaRecorder(n,r),this._recorder.addEventListener("dataavailable",(function(e){o.push(e.data)})),this._recorder.addEventListener("stop",(function(e){i._buildEmitter.emit("finish",o),o=[]}))};return n.prototype.start=function(e){var t=this;"inactive"===this._recorder.state&&(this._movie&&(this._movie.destroy(),this._movie=null),this._buildPromise=new Promise((function(e){t._buildEmitter.once("finish",(function(r){var n=new Blob(r,{type:r[0].type});t._movie=new i(n),e(t._movie)}))})),this._recorder.start(e))},n.prototype.finishAsync=function(){return"recording"!==this._recorder.state||this._recorder.stop(),this._buildPromise},n.prototype.pause=function(){"recording"===this._recorder.state&&this._recorder.pause()},n.prototype.resume=function(){"paused"===this._recorder.state&&this._recorder.resume()},n.prototype.addAudioAsync=function(e){var t=this;return void 0===e&&(e={display:!0}),Promise.resolve().then((function(){if(!e.user)return Promise.resolve();var i=!0===e.user?r:e.user;return navigator.mediaDevices.getUserMedia({audio:i}).then((function(e){e.getAudioTracks().forEach((function(e){t._recorder.stream.addTrack(e)}))}))})).then((function(){if(!e.display)return Promise.resolve();var i=!0===e.display?r:e.display;return navigator.mediaDevices.getDisplayMedia({audio:i}).then((function(e){e.getAudioTracks().forEach((function(e){t._recorder.stream.addTrack(e)}))}))}))},n}();//# sourceMappingURL=CanvasRecorder.min.js.map
