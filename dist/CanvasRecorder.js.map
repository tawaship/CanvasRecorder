{"version":3,"file":"CanvasRecorder.js","sources":["../node_modules/@tawaship/emitter/dist/Emitter.esm.js","../src/modules/CanvasRecorder.ts"],"sourcesContent":["/*!\n * @tawaship/emitter - v3.0.0\n * \n * @author tawaship (makazu.mori@gmail.com)\n * @license MIT\n */\n\nclass Emitter {\r\n    constructor() {\r\n        this._events = {};\r\n    }\r\n    /**\r\n     * Registered event names.\r\n     *\r\n     * @since 1.1.1\r\n     */\r\n    get eventNames() {\r\n        return Object.keys(this._events);\r\n    }\r\n    /**\r\n     * Register event.\r\n     *\r\n     * @param type Event type.\r\n     * @param func Callback when the event fires.\r\n     * @param once Whether one-time event.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    _on(type, func, once) {\r\n        if (!type || !func) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] = this._events[type] || [];\r\n        for (let i = 0; i < events.length; i++) {\r\n            if (events[i].func === func) {\r\n                return this;\r\n            }\r\n        }\r\n        events.push({ func, once });\r\n        return this;\r\n    }\r\n    /**\r\n     * Register event.\r\n     *\r\n     * @param type Event type.\r\n     * @param func Callback when the event fires.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    on(type, func) {\r\n        return this._on(type, func, false);\r\n    }\r\n    /**\r\n     * Register one-time event.\r\n     *\r\n     * @param type Event type.\r\n     * @param func Callback when the event fires.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    once(type, func) {\r\n        return this._on(type, func, true);\r\n    }\r\n    /**\r\n     * Unregister event.\r\n     *\r\n     * @param type Event type.\r\n     * @param func Registered callback.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    off(type, func) {\r\n        if (!type || !func) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        for (let i = 0; i < events.length; i++) {\r\n            if (events[i].func === func) {\r\n                events.splice(i, 1);\r\n                return this;\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Emit event.\r\n     *\r\n     * @param type Event type to emit.\r\n     * @param args Argument(s) in callback.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    emit(type, ...args) {\r\n        if (!type) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        const use = [];\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            const ev = events[i];\r\n            if (ev.once) {\r\n                events.splice(i, 1);\r\n            }\r\n            use.push(ev);\r\n        }\r\n        for (let i = use.length - 1; i >= 0; i--) {\r\n            use[i].func.apply(this, args);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Emit event with specifying a context.\r\n     *\r\n     * @param type Event type to emit.\r\n     * @param context 'this' context in callback.\r\n     * @param args Argument(s) in callback.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    cemit(type, context, ...args) {\r\n        if (!type || context == null) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        const use = [];\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            const ev = events[i];\r\n            if (ev.once) {\r\n                events.splice(i, 1);\r\n            }\r\n            use.push(ev);\r\n        }\r\n        for (let i = use.length - 1; i >= 0; i--) {\r\n            use[i].func.apply(context, args);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Remove events grouped event type.\r\n     *\r\n     * @param type Event type to remove.<br>If it is empty, removes all events.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    clear(type = '') {\r\n        if (type) {\r\n            delete (this._events[type]);\r\n        }\r\n        else {\r\n            this._events = {};\r\n        }\r\n        return this;\r\n    }\r\n}\n\nexport { Emitter };\n//# sourceMappingURL=Emitter.esm.js.map\n","import { Emitter } from '@tawaship/emitter';\r\n\r\n/**\r\n * @ignore\r\n */\r\ndeclare class MediaRecorder {\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tconstructor(...args: any[]);\r\n\t\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\t[props: string]: any;\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\ndeclare interface MediaRecordOptions {\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\t[props: string]: any;\r\n};\r\n\r\n/**\r\n * @ignore\r\n */\r\ndeclare type HTMLCanvasElement = any;\r\n\r\n/**\r\n * [[https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints#Properties]]\r\n */\r\nexport interface AudioOptions {\r\n\tuser?: boolean | MediaTrackConstraints;\r\n\tdisplay?: boolean | MediaTrackConstraints;\r\n}\r\n\r\n/**\r\n * @private\r\n */\r\nconst defaultUserAudioTrackConstraints: MediaTrackConstraints = { channelCount: 2 };\r\n\r\n/**\r\n * @private\r\n */\r\nconst defaultDisplayAudioTrackConstraints: MediaTrackConstraints = { channelCount: 2 };\r\n\r\n/**\r\n * @ignore\r\n */\r\ndeclare const navigator: any;\r\n\r\n/**\r\n * @private\r\n */\r\nclass Movie {\r\n\tprivate _blobURL: string;\r\n\t\r\n\tconstructor(blob: Blob) {\r\n\t\tthis._blobURL = window.URL.createObjectURL(blob);\r\n\t}\r\n\t\r\n\tcreateVideoElement() {\r\n\t\tif (!this._blobURL) {\r\n\t\t\tthrow new Error('[CanvasRecorder] This movie instance was destroyed.');\r\n\t\t}\r\n\t\t\r\n\t\tconst video = document.createElement('video');\r\n\t\tvideo.src = this._blobURL;\r\n\t\tvideo.setAttribute('controls', '');\r\n\t\treturn video;\r\n\t}\r\n\t\r\n\tdownload(filename?: string) {\r\n\t\tif (!this._blobURL) {\r\n\t\t\tthrow new Error('[CanvasRecorder] This movie instance was destroyed.');\r\n\t\t}\r\n\t\t\r\n\t\tconst anchor = document.createElement('a');\r\n\t\tanchor.download = filename ? `${filename}.webm` : `${location.hostname}_${new Date().toLocaleString().replace(/[\\/\\s\\:]/g, '-')}.webm`;\r\n\t\tanchor.href = this._blobURL;\r\n\t\tanchor.click();\r\n\t}\r\n\t\r\n\tdestroy() {\r\n\t\twindow.URL.revokeObjectURL(this._blobURL);\r\n\t\tthis._blobURL = null;\r\n\t}\r\n}\r\n\r\n/**\r\n * This API reference does not contain information for the parent class \"MediaRecorder\".<br />\r\n * For more information on \"MediaRecorder\", please refer to the following URL.<br />\r\n * [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder]]\r\n */\r\nexport class CanvasRecorder {\r\n\t/**\r\n\t * [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder]]\r\n\t */\r\n\tprivate _recorder: MediaRecorder;\r\n\t\r\n\tprivate _buildPromise: Promise<Movie> = null;\r\n\t\r\n\tprivate _buildEmitter: Emitter = new Emitter();\r\n\t\r\n\tprivate _movie: Movie = null;\r\n\t\r\n\t/**\r\n\t * @param stream [[https://developer.mozilla.org/ja/docs/Web/API/MediaStream]]\r\n\t * @param recordOptions [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder/MediaRecorder#Syntax]]\r\n\t */\r\n\tconstructor(stream: MediaStream, recordOptions: MediaRecordOptions = {}) {\r\n\t\tlet blobList: Blob[] = [];\r\n\t\t\r\n\t\tthis._recorder = new MediaRecorder(stream, recordOptions);\r\n\t\t\r\n\t\tthis._recorder.addEventListener('dataavailable', e => {\r\n\t\t\tblobList.push(e.data);\r\n\t\t});\r\n\t\t\r\n\t\tthis._recorder.addEventListener('stop', e => {\r\n\t\t\tthis._buildEmitter.emit('finish', blobList);\r\n\t\t\tblobList = [];\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Start recording\r\n\t * @param timeslice [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder/start#Syntax]]\r\n\t */\r\n\tstart(timeslice: number) {\r\n\t\tif (this._recorder.state !== 'inactive') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (this._movie) {\r\n\t\t\tthis._movie.destroy();\r\n\t\t\tthis._movie = null\r\n\t\t}\r\n\t\t\r\n\t\tthis._buildPromise = new Promise(resolve => {\r\n\t\t\tthis._buildEmitter.once('finish', blobList => {\r\n\t\t\t\tconst movieBlob = new Blob(blobList, { type: blobList[0].type });\r\n\t\t\t\tthis._movie = new Movie(movieBlob);\r\n\t\t\t\tresolve(this._movie);\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\tthis._recorder.start(timeslice);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finish recording and create a video file.\r\n\t */\r\n\tfinishAsync() {\r\n\t\tif (this._recorder.state !== 'recording') {\r\n\t\t\treturn this._buildPromise;\r\n\t\t}\r\n\t\t\r\n\t\tthis._recorder.stop();\r\n\t\t\r\n\t\treturn this._buildPromise;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Pause recording.\r\n\t */\r\n\tpause() {\r\n\t\tif (this._recorder.state !== 'recording') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._recorder.pause();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resume recording.\r\n\t */\r\n\tresume() {\r\n\t\tif (this._recorder.state !== 'paused') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._recorder.resume();\r\n\t}\r\n\t\r\n\tdestroy() {\r\n\t\tif (this._movie) {\r\n\t\t\tthis._movie.destroy();\r\n\t\t\tthis._movie = null;\r\n\t\t}\r\n\t}\r\n\t\r\n\taddAudioAsync(audioOptions: AudioOptions = { display: true }) {\r\n\t\tconst streams = [];\r\n\t\t\r\n\t\treturn Promise.resolve()\r\n\t\t\t.then(() => {\r\n\t\t\t\tif (!audioOptions.display) {\r\n\t\t\t\t\treturn Promise.resolve();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (!navigator.mediaDevices || !navigator.mediaDevices.getDisplayMedia) {\r\n\t\t\t\t\treturn Promise.reject();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst displayTrackConstraints = audioOptions.display === true ? defaultUserAudioTrackConstraints : audioOptions.display;\r\n\t\t\t\treturn navigator.mediaDevices.getDisplayMedia({ audio: displayTrackConstraints, video: true })\r\n\t\t\t\t\t.then(displayStream => streams.push(displayStream));\r\n\t\t\t\t\t/*\r\n\t\t\t\t\t.then(displayStream => {\r\n\t\t\t\t\t\tdisplayStream.getAudioTracks().forEach(track => {\r\n\t\t\t\t\t\t\tthis._recorder.stream.addTrack(track);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\t*/\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\tconsole.warn('[CanvasRecorder] Can not use display media.');\r\n\t\t\t})\r\n\t\t\t.then(() => {\r\n\t\t\t\tif (!audioOptions.user) {\r\n\t\t\t\t\treturn Promise.resolve();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n\t\t\t\t\treturn Promise.reject();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst userTrackConstraints = audioOptions.user === true ? defaultUserAudioTrackConstraints : audioOptions.user;\r\n\t\t\t\treturn navigator.mediaDevices.getUserMedia({ audio: userTrackConstraints })\r\n\t\t\t\t\t.then(userStream => streams.push(userStream));\r\n\t\t\t\t\t/*\r\n\t\t\t\t\t.then(userStream => {\r\n\t\t\t\t\t\tuserStream.getAudioTracks().forEach(track => {\r\n\t\t\t\t\t\t\tthis._recorder.stream.addTrack(track);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\t*/\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\tconsole.warn('[CanvasRecorder] Can not use user media.');\r\n\t\t\t})\r\n\t\t\t.then(() => {\r\n\t\t\t\tif (!AudioContext) {\r\n\t\t\t\t\tconsole.warn('[CanvasRecorder] Priority is given to \"display media\" as multiple audio tracks cannot be used.');\r\n\t\t\t\t\tstreams.forEach(stream => stream.getAudioTracks().forEach(track => this._recorder.stream.addTrack(track)));\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst audioContext = new AudioContext();\r\n\t\t\t\tconst destination = audioContext.createMediaStreamDestination();\r\n\t\t\t\t\r\n\t\t\t\tstreams.forEach(stream => audioContext.createMediaStreamSource(stream).connect(destination));\r\n\t\t\t\tthis._recorder.stream.addTrack(destination.stream.getAudioTracks()[0]);\r\n\t\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param canvas [[https://developer.mozilla.org/en/docs/Web/API/HTMLCanvasElement]]\r\n\t * @param recordOptions [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder/MediaRecorder#Syntax]]\r\n\t */\r\n\tstatic create(canvas: HTMLCanvasElement, recordOptions: MediaRecordOptions = {}) {\r\n\t\tconst stream = new MediaStream();\r\n\t\t\r\n\t\tcanvas.captureStream().getVideoTracks().forEach(track => {\r\n\t\t\tstream.addTrack(track);\r\n\t\t});\r\n\t\t\r\n\t\treturn new CanvasRecorder(stream, recordOptions);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param canvas [[https://developer.mozilla.org/en/docs/Web/API/HTMLCanvasElement]]\r\n\t * @param recordOptions [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder/MediaRecorder#Syntax]]\r\n\t */\r\n\tstatic createWithAudioAsync(canvas: HTMLCanvasElement, audioOptions: AudioOptions = { display: true }, recordOptions: MediaRecordOptions = {}) {\r\n\t\tconst recorder = CanvasRecorder.create(canvas, recordOptions);\r\n\t\t\r\n\t\treturn recorder.addAudioAsync(audioOptions)\r\n\t\t\t.then(() => recorder);\r\n\t}\r\n}"],"names":["Emitter","this","_events","prototypeAccessors","eventNames","Object","keys","_on","type","func","once","const","events","i","length","push","on","off","splice","emit","use","ev","let","apply","args","cemit","context","clear","defaultUserAudioTrackConstraints","channelCount","Movie","blob","_blobURL","window","URL","createObjectURL","createVideoElement","Error","video","document","createElement","src","setAttribute","download","filename","anchor","location","Date","toLocaleString","replace","href","click","destroy","revokeObjectURL","CanvasRecorder","stream","recordOptions","blobList","_recorder","MediaRecorder","addEventListener","e","data","_buildEmitter","start","timeslice","state","_movie","_buildPromise","Promise","resolve","movieBlob","Blob","finishAsync","stop","pause","resume","addAudioAsync","audioOptions","display","streams","then","navigator","mediaDevices","getDisplayMedia","reject","displayTrackConstraints","audio","displayStream","catch","console","warn","user","getUserMedia","userTrackConstraints","userStream","AudioContext","forEach","getAudioTracks","track","addTrack","audioContext","destination","createMediaStreamDestination","createMediaStreamSource","connect","create","canvas","MediaStream","captureStream","getVideoTracks","createWithAudioAsync","recorder"],"mappings":"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"}