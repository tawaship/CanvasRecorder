{"version":3,"file":"CanvasRecorder.cjs.js","sources":["../node_modules/@tawaship/emitter/dist/Emitter.esm.js","../src/modules/CanvasRecorder.ts"],"sourcesContent":["/*!\n * @tawaship/emitter - v3.0.0\n * \n * @author tawaship (makazu.mori@gmail.com)\n * @license MIT\n */\n\nclass Emitter {\r\n    constructor() {\r\n        this._events = {};\r\n    }\r\n    /**\r\n     * Registered event names.\r\n     *\r\n     * @since 1.1.1\r\n     */\r\n    get eventNames() {\r\n        return Object.keys(this._events);\r\n    }\r\n    /**\r\n     * Register event.\r\n     *\r\n     * @param type Event type.\r\n     * @param func Callback when the event fires.\r\n     * @param once Whether one-time event.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    _on(type, func, once) {\r\n        if (!type || !func) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] = this._events[type] || [];\r\n        for (let i = 0; i < events.length; i++) {\r\n            if (events[i].func === func) {\r\n                return this;\r\n            }\r\n        }\r\n        events.push({ func, once });\r\n        return this;\r\n    }\r\n    /**\r\n     * Register event.\r\n     *\r\n     * @param type Event type.\r\n     * @param func Callback when the event fires.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    on(type, func) {\r\n        return this._on(type, func, false);\r\n    }\r\n    /**\r\n     * Register one-time event.\r\n     *\r\n     * @param type Event type.\r\n     * @param func Callback when the event fires.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    once(type, func) {\r\n        return this._on(type, func, true);\r\n    }\r\n    /**\r\n     * Unregister event.\r\n     *\r\n     * @param type Event type.\r\n     * @param func Registered callback.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    off(type, func) {\r\n        if (!type || !func) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        for (let i = 0; i < events.length; i++) {\r\n            if (events[i].func === func) {\r\n                events.splice(i, 1);\r\n                return this;\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Emit event.\r\n     *\r\n     * @param type Event type to emit.\r\n     * @param args Argument(s) in callback.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    emit(type, ...args) {\r\n        if (!type) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        const use = [];\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            const ev = events[i];\r\n            if (ev.once) {\r\n                events.splice(i, 1);\r\n            }\r\n            use.push(ev);\r\n        }\r\n        for (let i = use.length - 1; i >= 0; i--) {\r\n            use[i].func.apply(this, args);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Emit event with specifying a context.\r\n     *\r\n     * @param type Event type to emit.\r\n     * @param context 'this' context in callback.\r\n     * @param args Argument(s) in callback.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    cemit(type, context, ...args) {\r\n        if (!type || context == null) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        const use = [];\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            const ev = events[i];\r\n            if (ev.once) {\r\n                events.splice(i, 1);\r\n            }\r\n            use.push(ev);\r\n        }\r\n        for (let i = use.length - 1; i >= 0; i--) {\r\n            use[i].func.apply(context, args);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Remove events grouped event type.\r\n     *\r\n     * @param type Event type to remove.<br>If it is empty, removes all events.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    clear(type = '') {\r\n        if (type) {\r\n            delete (this._events[type]);\r\n        }\r\n        else {\r\n            this._events = {};\r\n        }\r\n        return this;\r\n    }\r\n}\n\nexport { Emitter };\n//# sourceMappingURL=Emitter.esm.js.map\n","import { Emitter } from '@tawaship/emitter';\r\n\r\n/**\r\n * @ignore\r\n */\r\ndeclare class MediaRecorder {\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tconstructor(...args: any[]);\r\n\t\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\t[props: string]: any;\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\ndeclare interface MediaRecordOptions {\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\t[props: string]: any;\r\n};\r\n\r\n/**\r\n * @ignore\r\n */\r\ndeclare type HTMLCanvasElement = any;\r\n\r\n/**\r\n * [[https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints#Properties]]\r\n */\r\nexport interface AudioOptions {\r\n\tuser?: boolean | MediaTrackConstraints;\r\n\tdisplay?: boolean | MediaTrackConstraints;\r\n}\r\n\r\nexport interface FactoryOption {\r\n\tframerate?: number;\r\n\taudioOptions?: AudioOptions;\r\n\t/**\r\n\t * [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder/MediaRecorder#Syntax]]\r\n\t */\r\n\trecordOptions?: MediaRecordOptions;\r\n}\r\n\r\n/**\r\n * @private\r\n */\r\nconst defaultUserAudioTrackConstraints: MediaTrackConstraints = { channelCount: 2 } as MediaTrackConstraints;\r\n\r\n/**\r\n * @private\r\n */\r\nconst defaultDisplayAudioTrackConstraints: MediaTrackConstraints = { channelCount: 2 } as MediaTrackConstraints;\r\n\r\n/**\r\n * @ignore\r\n */\r\ndeclare const navigator: any;\r\n\r\n/**\r\n * @private\r\n */\r\nclass Movie {\r\n\tprivate _blobURL: string;\r\n\t\r\n\tconstructor(blob: Blob) {\r\n\t\tthis._blobURL = window.URL.createObjectURL(blob);\r\n\t}\r\n\t\r\n\t/**\r\n\t * [[https://developer.mozilla.org/en/docs/Web/API/HTMLVideoElement]]\r\n\t */\r\n\tcreateVideoElement() {\r\n\t\tif (!this._blobURL) {\r\n\t\t\tthrow new Error('[CanvasRecorder] This movie instance was destroyed.');\r\n\t\t}\r\n\t\t\r\n\t\tconst video = document.createElement('video');\r\n\t\tvideo.src = this._blobURL;\r\n\t\tvideo.setAttribute('controls', '');\r\n\t\t\r\n\t\treturn video;\r\n\t}\r\n\t\r\n\tdownload(filename?: string) {\r\n\t\tif (!this._blobURL) {\r\n\t\t\tthrow new Error('[CanvasRecorder] This movie instance was destroyed.');\r\n\t\t}\r\n\t\t\r\n\t\tconst anchor = document.createElement('a');\r\n\t\tanchor.download = filename ? `${filename}.webm` : `${location.hostname}_${new Date().toLocaleString().replace(/[\\/\\s\\:]/g, '-')}.webm`;\r\n\t\tanchor.href = this._blobURL;\r\n\t\tanchor.click();\r\n\t}\r\n\t\r\n\tget blobURL() {\r\n\t\tif (!this._blobURL) {\r\n\t\t\tthrow new Error('[CanvasRecorder] This movie instance was destroyed.');\r\n\t\t}\r\n\t\t\r\n\t\treturn this._blobURL;\r\n\t}\r\n\t\r\n\tdestroy() {\r\n\t\twindow.URL.revokeObjectURL(this._blobURL);\r\n\t\tthis._blobURL = null;\r\n\t}\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst DisplayStream = Symbol();\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst UserStream = Symbol();\r\n\r\n/*\r\n * This API reference does not contain information for the parent class \"MediaRecorder\".<br />\r\n * For more information on \"MediaRecorder\", please refer to the following URL.<br />\r\n * [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder]]\r\n */\r\nexport class CanvasRecorder {\r\n\t/**\r\n\t * [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder]]\r\n\t */\r\n\tprivate _recorder: MediaRecorder;\r\n\t\r\n\tprivate _buildPromise: Promise<Movie> = null;\r\n\t\r\n\tprivate _buildEmitter: Emitter = new Emitter();\r\n\t\r\n\tprivate _movie: Movie = null;\r\n\t\r\n\tprivate [DisplayStream]: MediaStream = null;\r\n\t\r\n\tprivate [UserStream]: MediaStream = null;\r\n\t\r\n\t/**\r\n\t * @param stream [[https://developer.mozilla.org/ja/docs/Web/API/MediaStream]]\r\n\t * @param recordOptions [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder/MediaRecorder#Syntax]]\r\n\t */\r\n\tconstructor(stream: MediaStream, recordOptions: MediaRecordOptions = {}) {\r\n\t\tlet blobList: Blob[] = [];\r\n\t\t\r\n\t\tthis._recorder = new MediaRecorder(stream, recordOptions);\r\n\t\t\r\n\t\tthis._recorder.addEventListener('dataavailable', e => {\r\n\t\t\tblobList.push(e.data);\r\n\t\t});\r\n\t\t\r\n\t\tthis._recorder.addEventListener('stop', e => {\r\n\t\t\tthis._buildEmitter.emit('finish', blobList);\r\n\t\t\tblobList = [];\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Start recording\r\n\t * @param timeslice [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder/start#Syntax]]\r\n\t */\r\n\tstart(timeslice: number) {\r\n\t\tif (this._recorder.state !== 'inactive') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis.clearMovie();\r\n\t\t\r\n\t\tthis._buildPromise = new Promise(resolve => {\r\n\t\t\tthis._buildEmitter.once('finish', blobList => {\r\n\t\t\t\tconst movieBlob = new Blob(blobList, { type: blobList[0].type });\r\n\t\t\t\tthis._movie = new Movie(movieBlob);\r\n\t\t\t\tresolve(this._movie);\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\tthis._recorder.start(timeslice);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finish recording and create a video file.\r\n\t */\r\n\tfinishAsync() {\r\n\t\tif (this._recorder.state !== 'recording') {\r\n\t\t\treturn this._buildPromise;\r\n\t\t}\r\n\t\t\r\n\t\tthis._recorder.stop();\r\n\t\t\r\n\t\treturn this._buildPromise;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Pause recording.\r\n\t */\r\n\tpause() {\r\n\t\tif (this._recorder.state !== 'recording') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._recorder.pause();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resume recording.\r\n\t */\r\n\tresume() {\r\n\t\tif (this._recorder.state !== 'paused') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._recorder.resume();\r\n\t}\r\n\t\r\n\tclearMovie() {\r\n\t\tif (this._movie) {\r\n\t\t\tthis._movie.destroy();\r\n\t\t\tthis._movie = null;\r\n\t\t}\r\n\t}\r\n\t\r\n\tdestroy() {\r\n\t\tthis.clearMovie();\r\n\t\tthis._recorder.stream.getTracks().forEach(track => track.stop());\r\n\t\t\r\n\t\tthis._releaseDisplayStream();\r\n\t\tthis._releaseUserStream();\r\n\t}\r\n\t\r\n\tprivate _releaseDisplayStream() {\r\n\t\tif (this[DisplayStream]) {\r\n\t\t\tthis[DisplayStream].getTracks().forEach(track => track.stop());\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate _releaseUserStream() {\r\n\t\tif (this[UserStream]) {\r\n\t\t\tthis[UserStream].getTracks().forEach(track => track.stop());\r\n\t\t}\r\n\t}\r\n\t\r\n\tdisabled(flag: boolean) {\r\n\t\tthis._recorder.stream.getTracks().forEach(track => track.enabled = !flag);\r\n\t}\r\n\t\r\n\thide(flag: boolean) {\r\n\t\tthis._recorder.stream.getVideoTracks().forEach(track => track.enabled = !flag);\r\n\t}\r\n\t\r\n\tmute(flag: boolean) {\r\n\t\tthis._recorder.stream.getAudioTracks().forEach(track => track.enabled = !flag);\r\n\t}\r\n\t\r\n\taddAudioAsync(audioOptions: AudioOptions = { display: true }) {\r\n\t\tconst streams = [];\r\n\t\t\r\n\t\treturn Promise.resolve()\r\n\t\t\t.then(() => {\r\n\t\t\t\tif (!audioOptions.display) {\r\n\t\t\t\t\treturn Promise.resolve();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (!navigator.mediaDevices || !navigator.mediaDevices.getDisplayMedia) {\r\n\t\t\t\t\treturn Promise.reject();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis._releaseDisplayStream();\r\n\t\t\t\t\r\n\t\t\t\tconst displayTrackConstraints = audioOptions.display === true ? defaultUserAudioTrackConstraints : audioOptions.display;\r\n\t\t\t\treturn navigator.mediaDevices.getDisplayMedia({ audio: displayTrackConstraints, video: true })\r\n\t\t\t\t\t.then(stream => {\r\n\t\t\t\t\t\tthis[DisplayStream] = stream;\r\n\t\t\t\t\t\tstream.getVideoTracks().forEach(track => track.stop());\r\n\t\t\t\t\t\tstreams.push(stream);\r\n\t\t\t\t\t})\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t\tconsole.warn('[CanvasRecorder] Can not use display media.');\r\n\t\t\t})\r\n\t\t\t.then(() => {\r\n\t\t\t\tif (!audioOptions.user) {\r\n\t\t\t\t\treturn Promise.resolve();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n\t\t\t\t\treturn Promise.reject();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis._releaseUserStream();\r\n\t\t\t\t\r\n\t\t\t\tconst userTrackConstraints = audioOptions.user === true ? defaultUserAudioTrackConstraints : audioOptions.user;\r\n\t\t\t\treturn navigator.mediaDevices.getUserMedia({ audio: userTrackConstraints })\r\n\t\t\t\t\t.then(stream => {\r\n\t\t\t\t\t\tthis[UserStream] = stream;\r\n\t\t\t\t\t\tstream.getVideoTracks().forEach(track => track.stop());\r\n\t\t\t\t\t\tstreams.push(stream)\r\n\t\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t\tconsole.warn('[CanvasRecorder] Can not use user media.');\r\n\t\t\t})\r\n\t\t\t.then(() => {\r\n\t\t\t\tif (!streams.length) {\r\n\t\t\t\t\tconsole.warn('[CanvasRecorder] No audio stream.');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst audioTrackNum = streams.reduce((total, stream) => {\r\n\t\t\t\t\treturn total + stream.getAudioTracks().length;\r\n\t\t\t\t}, 0);\r\n\t\t\t\t\r\n\t\t\t\tif (!audioTrackNum) {\r\n\t\t\t\t\tconsole.warn('[CanvasRecorder] No audio stream.');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (!AudioContext) {\r\n\t\t\t\t\tconsole.warn('[CanvasRecorder] Priority is given to \"display media\" as multiple audio tracks cannot be used.');\r\n\t\t\t\t\tstreams.forEach(stream => stream.getAudioTracks().forEach(track => this._recorder.stream.addTrack(track)));\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst audioContext = new AudioContext();\r\n\t\t\t\tconst destination = audioContext.createMediaStreamDestination();\r\n\t\t\t\t\r\n\t\t\t\tstreams.forEach(stream => audioContext.createMediaStreamSource(stream).connect(destination));\r\n\t\t\t\tthis._recorder.stream.addTrack(destination.stream.getAudioTracks()[0]);\r\n\t\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param canvas [[https://developer.mozilla.org/en/docs/Web/API/HTMLCanvasElement]]\r\n\t * @param factoryOptions\r\n\t */\r\n\tstatic createAsync(canvas: HTMLCanvasElement, factoryOptions?: FactoryOption) {\r\n\t\tfactoryOptions = factoryOptions || {};\r\n\t\t\r\n\t\tconst framerate = factoryOptions.framerate || 60;\r\n\t\tconst recordOptions = factoryOptions.recordOptions || {};\r\n\t\t\r\n\t\tconst stream = new MediaStream();\r\n\t\t\r\n\t\tcanvas.captureStream(framerate).getVideoTracks().forEach(track => {\r\n\t\t\tstream.addTrack(track);\r\n\t\t});\r\n\t\t\r\n\t\treturn Promise.resolve(new CanvasRecorder(stream, recordOptions));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param canvas [[https://developer.mozilla.org/en/docs/Web/API/HTMLCanvasElement]]\r\n\t * @param factoryOptions\r\n\t */\r\n\tstatic createWithAudioAsync(canvas: HTMLCanvasElement, factoryOptions?: FactoryOption) {\r\n\t\tfactoryOptions = factoryOptions || {};\r\n\t\t\r\n\t\tconst audioOptions = factoryOptions.audioOptions || { display: true };\r\n\t\t\r\n\t\treturn CanvasRecorder.createAsync(canvas, factoryOptions)\r\n\t\t\t.then(recorder => {\r\n\t\t\t\treturn recorder.addAudioAsync(audioOptions)\r\n\t\t\t\t\t.then(() => recorder);\r\n\t\t\t});\r\n\t}\r\n}"],"names":[],"mappings":"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"}