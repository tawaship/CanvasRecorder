{"version":3,"file":"CanvasRecorder.min.js","sources":["../node_modules/@tawaship/emitter/dist/Emitter.esm.js","../src/modules/CanvasRecorder.ts"],"sourcesContent":["/*!\n * @tawaship/emitter - v3.0.0\n * \n * @author tawaship (makazu.mori@gmail.com)\n * @license MIT\n */\n\nclass Emitter {\r\n    constructor() {\r\n        this._events = {};\r\n    }\r\n    /**\r\n     * Registered event names.\r\n     *\r\n     * @since 1.1.1\r\n     */\r\n    get eventNames() {\r\n        return Object.keys(this._events);\r\n    }\r\n    /**\r\n     * Register event.\r\n     *\r\n     * @param type Event type.\r\n     * @param func Callback when the event fires.\r\n     * @param once Whether one-time event.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    _on(type, func, once) {\r\n        if (!type || !func) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] = this._events[type] || [];\r\n        for (let i = 0; i < events.length; i++) {\r\n            if (events[i].func === func) {\r\n                return this;\r\n            }\r\n        }\r\n        events.push({ func, once });\r\n        return this;\r\n    }\r\n    /**\r\n     * Register event.\r\n     *\r\n     * @param type Event type.\r\n     * @param func Callback when the event fires.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    on(type, func) {\r\n        return this._on(type, func, false);\r\n    }\r\n    /**\r\n     * Register one-time event.\r\n     *\r\n     * @param type Event type.\r\n     * @param func Callback when the event fires.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    once(type, func) {\r\n        return this._on(type, func, true);\r\n    }\r\n    /**\r\n     * Unregister event.\r\n     *\r\n     * @param type Event type.\r\n     * @param func Registered callback.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    off(type, func) {\r\n        if (!type || !func) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        for (let i = 0; i < events.length; i++) {\r\n            if (events[i].func === func) {\r\n                events.splice(i, 1);\r\n                return this;\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Emit event.\r\n     *\r\n     * @param type Event type to emit.\r\n     * @param args Argument(s) in callback.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    emit(type, ...args) {\r\n        if (!type) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        const use = [];\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            const ev = events[i];\r\n            if (ev.once) {\r\n                events.splice(i, 1);\r\n            }\r\n            use.push(ev);\r\n        }\r\n        for (let i = use.length - 1; i >= 0; i--) {\r\n            use[i].func.apply(this, args);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Emit event with specifying a context.\r\n     *\r\n     * @param type Event type to emit.\r\n     * @param context 'this' context in callback.\r\n     * @param args Argument(s) in callback.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    cemit(type, context, ...args) {\r\n        if (!type || context == null) {\r\n            return this;\r\n        }\r\n        const events = this._events[type] || [];\r\n        const use = [];\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            const ev = events[i];\r\n            if (ev.once) {\r\n                events.splice(i, 1);\r\n            }\r\n            use.push(ev);\r\n        }\r\n        for (let i = use.length - 1; i >= 0; i--) {\r\n            use[i].func.apply(context, args);\r\n        }\r\n        return this;\r\n    }\r\n    /**\r\n     * Remove events grouped event type.\r\n     *\r\n     * @param type Event type to remove.<br>If it is empty, removes all events.\r\n     * @return Returns itself for the method chaining.\r\n     */\r\n    clear(type = '') {\r\n        if (type) {\r\n            delete (this._events[type]);\r\n        }\r\n        else {\r\n            this._events = {};\r\n        }\r\n        return this;\r\n    }\r\n}\n\nexport { Emitter };\n//# sourceMappingURL=Emitter.esm.js.map\n","import { Emitter } from '@tawaship/emitter';\r\n\r\n/**\r\n * @ignore\r\n */\r\ndeclare class MediaRecorder {\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tconstructor(...args: any[]);\r\n\t\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\t[props: string]: any;\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\ndeclare interface MediaRecordOptions {\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\t[props: string]: any;\r\n};\r\n\r\n/**\r\n * @ignore\r\n */\r\ndeclare type HTMLCanvasElement = any;\r\n\r\n/**\r\n * [[https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints#Properties]]\r\n */\r\nexport interface AudioOptions {\r\n\tuser?: boolean | MediaTrackConstraints;\r\n\tdisplay?: boolean | MediaTrackConstraints;\r\n}\r\n\r\n/**\r\n * @private\r\n */\r\nconst defaultUserAudioTrackConstraints: MediaTrackConstraints = { channelCount: 2 } as MediaTrackConstraints;\r\n\r\n/**\r\n * @private\r\n */\r\nconst defaultDisplayAudioTrackConstraints: MediaTrackConstraints = { channelCount: 2 } as MediaTrackConstraints;\r\n\r\n/**\r\n * @ignore\r\n */\r\ndeclare const navigator: any;\r\n\r\n/**\r\n * @private\r\n */\r\nclass Movie {\r\n\tprivate _blobURL: string;\r\n\t\r\n\tconstructor(blob: Blob) {\r\n\t\tthis._blobURL = window.URL.createObjectURL(blob);\r\n\t}\r\n\t\r\n\t/**\r\n\t * [[https://developer.mozilla.org/en/docs/Web/API/HTMLVideoElement]]\r\n\t */\r\n\tcreateVideoElement() {\r\n\t\tif (!this._blobURL) {\r\n\t\t\tthrow new Error('[CanvasRecorder] This movie instance was destroyed.');\r\n\t\t}\r\n\t\t\r\n\t\tconst video = document.createElement('video');\r\n\t\tvideo.src = this._blobURL;\r\n\t\tvideo.setAttribute('controls', '');\r\n\t\t\r\n\t\treturn video;\r\n\t}\r\n\t\r\n\tdownload(filename?: string) {\r\n\t\tif (!this._blobURL) {\r\n\t\t\tthrow new Error('[CanvasRecorder] This movie instance was destroyed.');\r\n\t\t}\r\n\t\t\r\n\t\tconst anchor = document.createElement('a');\r\n\t\tanchor.download = filename ? `${filename}.webm` : `${location.hostname}_${new Date().toLocaleString().replace(/[\\/\\s\\:]/g, '-')}.webm`;\r\n\t\tanchor.href = this._blobURL;\r\n\t\tanchor.click();\r\n\t}\r\n\t\r\n\tget blobURL() {\r\n\t\tif (!this._blobURL) {\r\n\t\t\tthrow new Error('[CanvasRecorder] This movie instance was destroyed.');\r\n\t\t}\r\n\t\t\r\n\t\treturn this._blobURL;\r\n\t}\r\n\t\r\n\tdestroy() {\r\n\t\twindow.URL.revokeObjectURL(this._blobURL);\r\n\t\tthis._blobURL = null;\r\n\t}\r\n}\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst DisplayStream = Symbol();\r\n\r\n/**\r\n * @ignore\r\n */\r\nconst UserStream = Symbol();\r\n\r\n/*\r\n * This API reference does not contain information for the parent class \"MediaRecorder\".<br />\r\n * For more information on \"MediaRecorder\", please refer to the following URL.<br />\r\n * [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder]]\r\n */\r\nexport class CanvasRecorder {\r\n\t/**\r\n\t * [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder]]\r\n\t */\r\n\tprivate _recorder: MediaRecorder;\r\n\t\r\n\tprivate _buildPromise: Promise<Movie> = null;\r\n\t\r\n\tprivate _buildEmitter: Emitter = new Emitter();\r\n\t\r\n\tprivate _movie: Movie = null;\r\n\t\r\n\tprivate [DisplayStream]: MediaStream = null;\r\n\t\r\n\tprivate [UserStream]: MediaStream = null;\r\n\t\r\n\t/**\r\n\t * @param stream [[https://developer.mozilla.org/ja/docs/Web/API/MediaStream]]\r\n\t * @param recordOptions [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder/MediaRecorder#Syntax]]\r\n\t */\r\n\tconstructor(stream: MediaStream, recordOptions: MediaRecordOptions = {}) {\r\n\t\tlet blobList: Blob[] = [];\r\n\t\t\r\n\t\tthis._recorder = new MediaRecorder(stream, recordOptions);\r\n\t\t\r\n\t\tthis._recorder.addEventListener('dataavailable', e => {\r\n\t\t\tblobList.push(e.data);\r\n\t\t});\r\n\t\t\r\n\t\tthis._recorder.addEventListener('stop', e => {\r\n\t\t\tthis._buildEmitter.emit('finish', blobList);\r\n\t\t\tblobList = [];\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Start recording\r\n\t * @param timeslice [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder/start#Syntax]]\r\n\t */\r\n\tstart(timeslice: number) {\r\n\t\tif (this._recorder.state !== 'inactive') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis.clearMovie();\r\n\t\t\r\n\t\tthis._buildPromise = new Promise(resolve => {\r\n\t\t\tthis._buildEmitter.once('finish', blobList => {\r\n\t\t\t\tconst movieBlob = new Blob(blobList, { type: blobList[0].type });\r\n\t\t\t\tthis._movie = new Movie(movieBlob);\r\n\t\t\t\tresolve(this._movie);\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\tthis._recorder.start(timeslice);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finish recording and create a video file.\r\n\t */\r\n\tfinishAsync() {\r\n\t\tif (this._recorder.state !== 'recording') {\r\n\t\t\treturn this._buildPromise;\r\n\t\t}\r\n\t\t\r\n\t\tthis._recorder.stop();\r\n\t\t\r\n\t\treturn this._buildPromise;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Pause recording.\r\n\t */\r\n\tpause() {\r\n\t\tif (this._recorder.state !== 'recording') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._recorder.pause();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resume recording.\r\n\t */\r\n\tresume() {\r\n\t\tif (this._recorder.state !== 'paused') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis._recorder.resume();\r\n\t}\r\n\t\r\n\tclearMovie() {\r\n\t\tif (this._movie) {\r\n\t\t\tthis._movie.destroy();\r\n\t\t\tthis._movie = null;\r\n\t\t}\r\n\t}\r\n\t\r\n\tdestroy() {\r\n\t\tthis.clearMovie();\r\n\t\tthis._recorder.stream.getTracks().forEach(track => track.stop());\r\n\t\t\r\n\t\tthis._releaseDisplayStream();\r\n\t\tthis._releaseUserStream();\r\n\t}\r\n\t\r\n\tprivate _releaseDisplayStream() {\r\n\t\tif (this[DisplayStream]) {\r\n\t\t\tthis[DisplayStream].getTracks().forEach(track => track.stop());\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate _releaseUserStream() {\r\n\t\tif (this[UserStream]) {\r\n\t\t\tthis[UserStream].getTracks().forEach(track => track.stop());\r\n\t\t}\r\n\t}\r\n\t\r\n\tdisabled(flag: boolean) {\r\n\t\tthis._recorder.stream.getTracks().forEach(track => track.enabled = !flag);\r\n\t}\r\n\t\r\n\thide(flag: boolean) {\r\n\t\tthis._recorder.stream.getVideoTracks().forEach(track => track.enabled = !flag);\r\n\t}\r\n\t\r\n\tmute(flag: boolean) {\r\n\t\tthis._recorder.stream.getAudioTracks().forEach(track => track.enabled = !flag);\r\n\t}\r\n\t\r\n\taddAudioAsync(audioOptions: AudioOptions = { display: true }) {\r\n\t\tconst streams = [];\r\n\t\t\r\n\t\treturn Promise.resolve()\r\n\t\t\t.then(() => {\r\n\t\t\t\tif (!audioOptions.display) {\r\n\t\t\t\t\treturn Promise.resolve();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (!navigator.mediaDevices || !navigator.mediaDevices.getDisplayMedia) {\r\n\t\t\t\t\treturn Promise.reject();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis._releaseDisplayStream();\r\n\t\t\t\t\r\n\t\t\t\tconst displayTrackConstraints = audioOptions.display === true ? defaultUserAudioTrackConstraints : audioOptions.display;\r\n\t\t\t\treturn navigator.mediaDevices.getDisplayMedia({ audio: displayTrackConstraints, video: true })\r\n\t\t\t\t\t.then(stream => {\r\n\t\t\t\t\t\tthis[DisplayStream] = stream;\r\n\t\t\t\t\t\tstream.getVideoTracks().forEach(track => track.stop());\r\n\t\t\t\t\t\tstreams.push(stream);\r\n\t\t\t\t\t})\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t\tconsole.warn('[CanvasRecorder] Can not use display media.');\r\n\t\t\t})\r\n\t\t\t.then(() => {\r\n\t\t\t\tif (!audioOptions.user) {\r\n\t\t\t\t\treturn Promise.resolve();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n\t\t\t\t\treturn Promise.reject();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis._releaseUserStream();\r\n\t\t\t\t\r\n\t\t\t\tconst userTrackConstraints = audioOptions.user === true ? defaultUserAudioTrackConstraints : audioOptions.user;\r\n\t\t\t\treturn navigator.mediaDevices.getUserMedia({ audio: userTrackConstraints })\r\n\t\t\t\t\t.then(stream => {\r\n\t\t\t\t\t\tthis[UserStream] = stream;\r\n\t\t\t\t\t\tstream.getVideoTracks().forEach(track => track.stop());\r\n\t\t\t\t\t\tstreams.push(stream)\r\n\t\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t\tconsole.warn('[CanvasRecorder] Can not use user media.');\r\n\t\t\t})\r\n\t\t\t.then(() => {\r\n\t\t\t\tif (!streams.length) {\r\n\t\t\t\t\tconsole.warn('[CanvasRecorder] No audio stream.');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst audioTrackNum = streams.reduce((total, stream) => {\r\n\t\t\t\t\treturn total + stream.getAudioTracks().length;\r\n\t\t\t\t}, 0);\r\n\t\t\t\t\r\n\t\t\t\tif (!audioTrackNum) {\r\n\t\t\t\t\tconsole.warn('[CanvasRecorder] No audio stream.');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (!AudioContext) {\r\n\t\t\t\t\tconsole.warn('[CanvasRecorder] Priority is given to \"display media\" as multiple audio tracks cannot be used.');\r\n\t\t\t\t\tstreams.forEach(stream => stream.getAudioTracks().forEach(track => this._recorder.stream.addTrack(track)));\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst audioContext = new AudioContext();\r\n\t\t\t\tconst destination = audioContext.createMediaStreamDestination();\r\n\t\t\t\t\r\n\t\t\t\tstreams.forEach(stream => audioContext.createMediaStreamSource(stream).connect(destination));\r\n\t\t\t\tthis._recorder.stream.addTrack(destination.stream.getAudioTracks()[0]);\r\n\t\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param canvas [[https://developer.mozilla.org/en/docs/Web/API/HTMLCanvasElement]]\r\n\t * @param recordOptions [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder/MediaRecorder#Syntax]]\r\n\t */\r\n\tstatic createAsync(canvas: HTMLCanvasElement, recordOptions: MediaRecordOptions = {}) {\r\n\t\tconst stream = new MediaStream();\r\n\t\t\r\n\t\tcanvas.captureStream().getVideoTracks().forEach(track => {\r\n\t\t\tstream.addTrack(track);\r\n\t\t});\r\n\t\t\r\n\t\treturn Promise.resolve(new CanvasRecorder(stream, recordOptions));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param canvas [[https://developer.mozilla.org/en/docs/Web/API/HTMLCanvasElement]]\r\n\t * @param recordOptions [[https://developer.mozilla.org/en/docs/Web/API/MediaRecorder/MediaRecorder#Syntax]]\r\n\t */\r\n\tstatic createWithAudioAsync(canvas: HTMLCanvasElement, audioOptions: AudioOptions = { display: true }, recordOptions: MediaRecordOptions = {}) {\r\n\t\treturn CanvasRecorder.createAsync(canvas, recordOptions)\r\n\t\t\t.then(recorder => {\r\n\t\t\t\treturn recorder.addAudioAsync(audioOptions)\r\n\t\t\t\t\t.then(() => recorder);\r\n\t\t\t});\r\n\t}\r\n}"],"names":["Emitter","this","_events","prototypeAccessors","eventNames","Object","keys","_on","type","func","once","const","events","i","length","push","on","off","splice","emit","use","ev","let","apply","args","cemit","context","clear","defaultUserAudioTrackConstraints","channelCount","Movie","blob","_blobURL","window","URL","createObjectURL","createVideoElement","Error","video","document","createElement","src","setAttribute","download","filename","anchor","location","Date","toLocaleString","replace","href","click","blobURL","destroy","revokeObjectURL","DisplayStream","Symbol","UserStream","CanvasRecorder","stream","recordOptions","blobList","_recorder","MediaRecorder","addEventListener","e","data","_buildEmitter","start","timeslice","state","clearMovie","_buildPromise","Promise","resolve","movieBlob","Blob","_movie","finishAsync","stop","pause","resume","getTracks","forEach","track","_releaseDisplayStream","_releaseUserStream","disabled","flag","enabled","hide","getVideoTracks","mute","getAudioTracks","addAudioAsync","audioOptions","display","streams","then","navigator","mediaDevices","getDisplayMedia","reject","displayTrackConstraints","audio","catch","console","error","warn","user","getUserMedia","userTrackConstraints","reduce","total","AudioContext","addTrack","audioContext","destination","createMediaStreamDestination","createMediaStreamSource","connect","createAsync","canvas","MediaStream","captureStream","createWithAudioAsync","recorder"],"mappings":"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"}